"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs = require("fs");
const path = require("path");
var modTsFile;
(function (modTsFile) {
    /** create [projectPath]/mod.ts file */
    function create(params) {
        const { projectPath, tsFilePath, isDryRun } = params;
        const modTsRaw = [
            `//Automatically generated by denoify.`,
            ` It is important not to edit this file.\n`,
            ("metadata" in params) ? `// #${JSON.stringify(params.metadata)}#\n\n` : "",
            `export * from "${tsFilePath.startsWith("./") ? "" : "./"}${tsFilePath}";`
        ].join("");
        if (!isDryRun) {
            fs.writeFileSync(path.join(projectPath, "mod.ts"), Buffer.from(modTsRaw, "utf8"));
        }
        else {
            console.log(`(dry) mod.ts\n\n${modTsRaw}\n`);
        }
    }
    modTsFile.create = create;
    /** Assert has been created with metadata */
    function parseMetadata(params) {
        const { projectPath } = params;
        const [, metadataJson] = fs.readFileSync(path.join(projectPath, "mod.ts"))
            .toString("utf8")
            .split("#");
        if (!metadataJson) {
            throw new Error("No metadata in mod.ts");
        }
        return JSON.parse(metadataJson);
    }
    modTsFile.parseMetadata = parseMetadata;
})(modTsFile = exports.modTsFile || (exports.modTsFile = {}));
